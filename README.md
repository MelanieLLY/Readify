# Readify - 网页文字朗读助手

一个Chrome浏览器插件，使用OpenAI的TTS API来朗读网页上的文字，支持语速调节和多种语音选择。

## 功能特性

- 🎯 **智能文字提取**: 自动提取网页上的段落文字，支持手动选择
- 🎵 **高质量语音**: 使用OpenAI的GPT-4o-mini TTS模型，提供自然流畅的语音
- ⚡ **语速调节**: 支持0.5x到2.0x的语速调节，可实时调整正在播放的音频
- 🎭 **多种语音**: 支持Nova、Alloy、Echo、Fable、Onyx、Shimmer六种语音
- 🔊 **段落朗读**: 在每个自然段末尾显示喇叭图标，点击即可朗读该段落
- 💰 **节省费用**: 支持按段落朗读，避免发送整篇文章给API，节省OpenAI费用
- 🔒 **安全存储**: API Key安全存储在本地Chrome存储中
- 🎨 **现代化UI**: 简洁美观的用户界面

## 安装方法

1. 下载或克隆此项目到本地
2. 打开Chrome浏览器，进入扩展程序页面 (`chrome://extensions/`)
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目文件夹
6. 插件安装完成！

## 使用方法

### 1. 设置API Key
1. 点击浏览器工具栏中的Readify图标
2. 在"OpenAI API Key"输入框中输入你的API Key
3. 点击"保存"按钮

### 2. 调节设置
- **语速调节**: 使用滑块调节播放速度（0.5x - 2.0x），可实时调整正在播放的音频
- **语音选择**: 从下拉菜单中选择喜欢的语音

### 3. 开始朗读
- **朗读页面文字**: 点击"朗读页面文字"按钮，插件会自动提取页面内容
- **朗读选中文字**: 先选中网页上的文字，然后点击"朗读选中文字"按钮
- **段落朗读**: 启用"段落朗读功能"后，每个段落末尾会显示喇叭图标，点击即可朗读该段落
- **停止朗读**: 点击"停止朗读"按钮

### 4. 段落朗读功能
- **启用/禁用**: 在弹出窗口中勾选"在段落末尾显示朗读图标"
- **智能显示**: 只对长度超过10个字符的段落显示图标
- **状态反馈**: 图标会根据朗读状态变化（加载中、播放中、完成、错误）
- **节省费用**: 只朗读选中的段落，避免发送整篇文章给API

## 文件结构说明

```
Readify/
├── manifest.json          # 插件配置文件
├── popup.html             # 弹出窗口界面
├── popup.css              # 弹出窗口样式
├── popup.js               # 弹出窗口逻辑
├── content.js             # 内容脚本（与网页交互）
├── content.css            # 内容脚本样式
├── background.js          # 后台脚本（处理API调用）
└── README.md              # 说明文档
```

## API Key安全性说明

### 推荐方案：从popup输入并存储

**优点：**
- ✅ **最高安全性**: API Key不会出现在代码中
- ✅ **用户控制**: 用户可以随时更改或删除API Key
- ✅ **无泄露风险**: 即使代码被分享，也不会泄露API Key
- ✅ **符合最佳实践**: 遵循API Key管理的最佳实践

**实现方式：**
- API Key存储在`chrome.storage.sync`中
- 使用密码输入框隐藏显示
- 仅在需要时从存储中读取

### 不推荐：写死在代码中

**风险：**
- ❌ **代码泄露**: 如果代码被分享或上传到公共仓库，API Key会泄露
- ❌ **无法更改**: 需要修改代码才能更改API Key
- ❌ **安全风险**: 即使只是自己使用，也存在意外泄露的风险

## 技术实现

### 文字提取策略
1. **优先提取段落**: 尝试提取所有`<p>`标签内的文字
2. **主要内容区域**: 查找`main`、`article`等主要内容标签
3. **全页面提取**: 作为后备方案，提取所有文本内容
4. **手动选择**: 支持用户手动选择特定文字
5. **段落朗读**: 在每个自然段末尾添加喇叭图标，支持精确朗读

### 段落朗读功能
- **智能检测**: 自动检测页面中的段落元素
- **动态更新**: 监听DOM变化，为新添加的段落自动添加图标
- **状态管理**: 图标状态包括加载中(⏳)、播放中(🔊)、错误(❌)
- **用户控制**: 可以随时启用或禁用段落朗读功能

### TTS API调用
- 使用OpenAI的`gpt-4o-mini-tts`模型
- 支持MP3格式输出
- 自动处理API错误和网络问题

### 音频播放
- 使用Web Audio API播放音频
- 支持播放速度调节
- 自动资源清理

## 注意事项

1. **API费用**: 使用OpenAI TTS API会产生费用，请合理使用
2. **网络要求**: 需要稳定的网络连接来调用API
3. **文字长度**: 建议朗读的文字长度不超过2000字符
4. **浏览器兼容性**: 仅支持Chrome浏览器

## 故障排除

### 常见问题

**Q: 插件无法提取页面文字？**
A: 尝试手动选择要朗读的文字，或检查页面是否有足够的内容。

**Q: TTS API调用失败？**
A: 检查API Key是否正确，网络连接是否正常，以及API配额是否充足。

**Q: 音频无法播放？**
A: 检查浏览器是否允许音频播放，以及系统音量设置。

**Q: 段落朗读显示"缺少必要参数"错误？**
A: 确保已在插件设置中正确保存了OpenAI API Key。点击插件图标，在"OpenAI API Key"输入框中输入你的API Key，然后点击"保存"。

**Q: 段落末尾没有显示喇叭图标？**
A: 确保已启用段落朗读功能。在插件弹出窗口中勾选"在段落末尾显示朗读图标"，然后刷新页面。

**Q: 点击喇叭图标没有反应？**
A: 检查浏览器控制台的错误信息，确保API Key已正确设置，网络连接正常。

**Q: 显示"URL.createObjectURL is not a function"或"Audio is not defined"错误？**
A: 这些问题已经修复。音频播放现在在content script中进行，而不是在background script中。如果仍然遇到音频播放问题，请确保使用的是最新版本的插件代码。

### 调试工具

项目包含三个测试页面：
- `test.html` - 功能演示页面
- `debug.html` - 调试和故障排除页面
- `test-audio.html` - 音频播放功能测试页面

使用这些页面可以更容易地测试和诊断插件功能。

## 开发说明

### 添加新功能
1. 在相应的脚本文件中添加功能代码
2. 更新`manifest.json`中的权限（如需要）
3. 测试功能是否正常工作

### 自定义样式
- 修改`popup.css`来改变弹出窗口样式
- 修改`content.css`来改变网页中的高亮样式

## 许可证

此项目仅供个人学习和使用。请遵守OpenAI的使用条款和API使用政策。 